<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#2563eb">
    <title>Bruchverkauf Kassensystem</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="manifest" href="manifest.json">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üõí</text></svg>">
</head>
<body>
    <div id="app">
        <!-- Dashboard -->
        <div id="dashboard" class="page active">
            <header>
                <h1>Bruchverkauf</h1>
            </header>
            <main class="dashboard-grid">
                <button id="scan-btn" class="dashboard-btn primary">
                    <span class="icon">üì∑</span>
                    Scanner
                </button>
                <button id="cart-btn" class="dashboard-btn">
                    <span class="icon">üõí</span>
                    Warenkorb
                </button>
                <button id="articles-btn" class="dashboard-btn">
                    <span class="icon">üì¶</span>
                    Artikel
                </button>
                <button id="sales-btn" class="dashboard-btn">
                    <span class="icon">üìä</span>
                    Verk√§ufe
                </button>
                <button id="import-export-btn" class="dashboard-btn">
                    <span class="icon">üîÑ</span>
                    Import/Export
                </button>
            </main>
        </div>

        <!-- Scanner -->
        <div id="scanner" class="page">
            <header>
                <button class="back-btn">‚Üê Zur√ºck</button>
                <h1>Scanner</h1>
            </header>
            <main>
                <div id="reader"></div>
                <div class="scanner-controls">
                    <button id="start-scan" class="btn primary">Scan starten</button>
                    <button id="stop-scan" class="btn secondary" disabled>Scan stoppen</button>
                </div>
                <div id="scan-result" class="hidden">
                    <p id="scan-result-text"></p>
                    <div id="scan-result-actions" class="scan-result-actions"></div>
                </div>
            </main>
        </div>

        <!-- Warenkorb -->
        <div id="cart" class="page">
            <header>
                <button class="back-btn">‚Üê Zur√ºck</button>
                <h1>Warenkorb</h1>
            </header>
            <main>
                <div id="cart-items" class="cart-items">
                    <p class="empty-state">Warenkorb ist leer</p>
                </div>
                <div class="cart-summary">
                    <div class="summary-row">
                        <span>Zwischensumme:</span>
                        <span id="subtotal">0,00 ‚Ç¨</span>
                    </div>
                    <div class="summary-row total">
                        <span>Gesamtsumme:</span>
                        <span id="total">0,00 ‚Ç¨</span>
                    </div>
                </div>
                <div class="cart-actions">
                    <button id="checkout-btn" class="btn primary" disabled>Verkauf abschlie√üen</button>
                    <button id="clear-cart" class="btn secondary">Warenkorb leeren</button>
                </div>
            </main>
        </div>

        <!-- Artikelverwaltung -->
        <div id="articles" class="page">
            <header>
                <button class="back-btn">‚Üê Zur√ºck</button>
                <h1>Artikelverwaltung</h1>
                <button id="add-article-btn" class="btn primary">+ Artikel</button>
            </header>
            <main>
                <div class="search-bar">
                    <input type="text" id="article-search" placeholder="Artikel suchen...">
                </div>
                <div id="articles-list" class="articles-list">
                    <p class="empty-state">Keine Artikel vorhanden</p>
                </div>
            </main>
        </div>

        <!-- Verkaufshistorie -->
        <div id="sales" class="page">
            <header>
                <button class="back-btn">‚Üê Zur√ºck</button>
                <h1>Verkaufshistorie</h1>
            </header>
            <main>
                <div class="sales-controls">
                    <button id="export-sales" class="btn secondary">Verk√§ufe exportieren</button>
                </div>
                <div id="sales-list" class="sales-list">
                    <p class="empty-state">Keine Verk√§ufe vorhanden</p>
                </div>
            </main>
        </div>

        <!-- Import/Export -->
        <div id="import-export" class="page">
            <header>
                <button class="back-btn">‚Üê Zur√ºck</button>
                <h1>Import/Export</h1>
            </header>
            <div class="main-nav">
                <button id="scan-btn" class="main-nav-btn">
                    <span class="icon">üì∑</span>
                    <span>Scannen</span>
                </button>
                <button id="cart-btn" class="main-nav-btn">
                    <span class="icon">üõí</span>
                    <span>Warenkorb</span>
                </button>
                <button id="articles-btn" class="main-nav-btn">
                    <span class="icon">üìã</span>
                    <span>Artikel</span>
                </button>
                <button id="sales-btn" class="main-nav-btn">
                    <span class="icon">üìä</span>
                    <span>Verk√§ufe</span>
                </button>
                <button id="import-export-btn" class="main-nav-btn">
                    <span class="icon">üîÑ</span>
                    <span>Daten</span>
                </button>
            </div>
            <div class="import-export-section">
                <h2>Artikel exportieren</h2>
                <button id="export-articles-json" class="btn secondary">Als JSON exportieren</button>
                <button id="export-articles-csv" class="btn secondary">Als CSV exportieren</button>
            </div>
            
            <div class="import-export-section">
                <h2>Artikel importieren</h2>
                <input type="file" id="import-file" accept=".json,.csv" class="file-input">
                <div class="import-options">
                    <label>
                        <input type="radio" name="import-mode" value="overwrite" checked>
                        Vorhandene √ºberschreiben
                    </label>
                    <label>
                        <input type="radio" name="import-mode" value="merge">
                        Mit vorhandenen zusammenf√ºhren
                    </label>
                </div>
                <button id="import-articles" class="btn secondary" disabled>Import starten</button>
            </div>
                            <input type="radio" name="import-mode" value="overwrite" checked>
                            Vorhandene √ºberschreiben
                        </label>
                        <label>
                            <input type="radio" name="import-mode" value="merge">
                            Mit vorhandenen zusammenf√ºhren
                        </label>
                    </div>
        </div>
    </div>

    <!-- Article Modal -->
    <div id="article-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="article-modal-title">Neuen Artikel anlegen</h2>
                <button type="button" class="close-btn" onclick="app.hideModal('article-modal')">&times;</button>
            </div>
            <form id="article-form" onsubmit="app.saveArticle(event)">
                <input type="hidden" id="article-id">
                <div class="form-row">
                    <div class="form-group">
                        <label for="article-number">Artikelnummer *</label>
                        <input type="text" id="article-number" class="form-control" placeholder="z.B. 1001" required>
                    </div>
                    <div class="form-group">
                        <label for="article-unit">Verkaufseinheit *</label>
                        <select id="article-unit" class="form-control" required>
                            <option value="Stk">St√ºck (Stk)</option>
                            <option value="kg">Kilogramm (kg)</option>
                            <option value="g">Gramm (g)</option>
                            <option value="l">Liter (l)</option>
                            <option value="ml">Milliliter (ml)</option>
                            <option value="m">Meter (m)</option>
                            <option value="cm">Zentimeter (cm)</option>
                            <option value="m¬≤">Quadratmeter (m¬≤)</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label for="article-name">Bezeichnung *</label>
                    <input type="text" id="article-name" class="form-control" placeholder="z.B. Schraube 4x20 mm" required>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="article-ean">EAN-Code</label>
                        <div class="input-with-button">
                            <input type="text" id="article-ean" class="form-control" placeholder="Barcode scannen">
                            <button type="button" class="btn secondary" onclick="app.startBarcodeScanner('article-ean')">
                                <span class="icon">üì∑</span> Scannen
                            </button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="article-price">Preis (‚Ç¨) *</label>
                        <input type="text" id="article-price" class="form-control" 
                               placeholder="0,00" pattern="\d+([,.]\d{1,2})?" required>
                    </div>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn secondary" onclick="app.hideModal('article-modal')">Abbrechen</button>
                    <button type="submit" class="btn primary" id="save-article">Speichern</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Price Check Modal -->
    <div id="price-check-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Preisabfrage</h2>
                <button type="button" class="close-btn" onclick="app.hideModal('price-check-modal')">&times;</button>
            </div>
            <div class="modal-body">
                <div id="price-check-scanner" class="scanner-container">
                    <div id="price-check-reader"></div>
                    <div class="scanner-overlay">
                        <div class="scanner-frame"></div>
                        <p class="scanner-hint">Scannen Sie einen Barcode</p>
                    </div>
                </div>
                <div id="price-check-result" class="price-check-result" style="display: none;">
                    <h3 id="price-check-article">Artikelname</h3>
                    <div class="price-details">
                        <div class="price-amount" id="price-check-price">-,- ‚Ç¨</div>
                        <div class="price-unit" id="price-check-unit">pro St√ºck</div>
                    </div>
                    <div class="price-actions">
                        <button type="button" class="btn secondary" onclick="app.closePriceCheck()">Schlie√üen</button>
                        <button type="button" class="btn primary" id="add-to-cart-from-price-check">
                            In Warenkorb
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="checkout-modal" class="modal hidden">
        <div class="modal-content">
            <h2>Verkauf abschlie√üen</h2>
            <form id="checkout-form">
                <div class="form-group">
                    <label for="personal-number">Personalnummer</label>
                    <input type="text" id="personal-number" required>
                </div>\
                <div class="cart-summary">\
                    <div class="summary-row">\
                        <span>Zwischensumme:</span>\
                        <span id="checkout-subtotal">0,00 \'80</span>\
                    </div>\
                    <div class="summary-row total">\
                        <span>Gesamtsumme:</span>\
                        <span id="checkout-total">0,00 \'80</span>\
                    </div>\
                </div>\
                <div class="form-actions">\
                    <button type="button" class="btn secondary" id="cancel-checkout">Abbrechen</button>\
                    <button type="submit" class="btn primary">PDF-Beleg erstellen</button>\
                </div>\
            </form>\
        </div>\
    </div>\
\
    <!-- Scripts -->\
    <script src="https://unpkg.com/idb@7/build/umd.js"></script>\
    <script src="https://unpkg.com/html5-qrcode/minified/html5-qrcode.min.js"></script>\
    <script src="https://unpkg.com/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>\
    <script src="db.js"></script>\
    <script src="main.js"></script>\
</body>\
</html>}